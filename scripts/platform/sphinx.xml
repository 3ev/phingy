<?xml version="1.0" encoding="UTF-8"?>
<project name="" basedir="." default="...">    
    



    <!-- ==================================== -->
    <!--                Tasks                 -->
    <!-- ==================================== -->




    <!--
        Build before hook. Symlinks Sphinx.
    -->
    <target name="sphinx:build:before" description="Hook" hidden="true">
       <chmod file="${build.path}/data/sphinx/xmlpipe" mode="0775" />
       <phingcall target="sphinx:symlink" />
    </target>


    <!--
        Build after hook. Indexes data.
    -->
    <target name="sphinx:build:after" description="Hook" hidden="true">
        <phingcall target="sphinx:index" />
    </target>


    <!--
        Housekeeping hook. Not used.
    -->
    <target name="sphinx:build:housekeeping" description="Hook" hidden="true">
        <echo message="Not used" />
    </target>


    <!--
        Symlink Sphinx
    -->
    <target name="sphinx:symlink" description="Setup the Sphinx symlink" depends="build:need_configuration" hidden="true">
        <if>
            <equals arg1="${build.environment}" arg2="development" />
            <then>
                <echo message="Symlinking Sphinx config as in development" />
                <symlink target="${build.path}/config/sphinx.conf" link="${share.path}/sphinx/${build.name}.include" />
            </then>
            <else>
                <echo message="In production, did not symlink" />
            </else>
        </if>
    </target>
    

    <!--
        Index Sphinx indexes
    -->
    <target name="sphinx:index" description="Index all Sphinx indexes">
        <exec command="sed -n 's/.*source = \([a-Z]\)/\1/p' ${build.path}/config/sphinx.conf | paste -s -d &quot; &quot;" dir="${share.path}/sphinx" escape="false" passthru="true" />
    </target>




</project>
