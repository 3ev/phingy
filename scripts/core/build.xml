<?xml version="1.0" encoding="UTF-8"?>
<project name="" basedir="." default="...">
    <target name="readme" hidden="true">
        <echo msg="===================================" />
        <echo msg="===================================" />
        <echo msg="==== NOTHING HAPPENED =============" level="warning" />
        <echo msg="" level="warning" />
        <echo msg="     phing -l to see what to do" level="warning" />
        <echo msg="" level="warning" />
        <echo msg="===================================" />
        <echo msg="===================================" />
    </target>
    
    <target name="build:skel" description="Applies configuration to skel files" depends="needConfiguration">
        <echo msg="Skel files..." />

        <copy todir="" overwrite="true">
            <mapper type="glob" from="*.skel" to="*"/>
            <filterchain>
                <expandproperties />
            </filterchain>

            <fileset dir=".">
                <include name="**/*.skel" />
            </fileset>
        </copy>

        <chmod mode="0755">
            <fileset dir="./bin">
                <include name="*" />
            </fileset>
        </chmod>
    </target>
    
    <target name="build" description="Build the project" depends="needConfiguration">
        <phingcall target="project.build:before" />
        <phingcall target="platform:build:before" />
        <phingcall target="build:skel" />
        <phingcall target="db:update" />
        <phingcall target="project.build:after" />
        <phingcall target="platform:build:after" />
    </target>

    <!-- Remove cached config files -->
    <target name="build:clearcache" depends="needConfiguration" description="Clear cached YAML config (Is this used?)">
        <exec command="sudo rm htdocs/typo3temp/config_cache*" escape="false" />
    </target>
    
    <target name="build:server" description="Symlink site into sites-enabled AND restart apache">
        <echo msg="Deprecated. Doing nothing" level="error" />
    </target>
    
    <target name="build:housekeeping" description="Delete everything which isn't required for the running of the site. Logs etc">
        <phingcall target="project.build:housekeeping" />
    </target>
</project>